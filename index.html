<html>
  <head>
	<style>
canvas {
    image-rendering: optimizeSpeed;             // Older versions of FF
    image-rendering: -moz-crisp-edges;          // FF 6.0+
    image-rendering: -webkit-optimize-contrast; // Webkit
                                                //  (Safari now, Chrome soon)
    image-rendering: -o-crisp-edges;            // OS X & Windows Opera (12.02+)
    image-rendering: optimize-contrast;         // Possible future browsers.
    -ms-interpolation-mode: nearest-neighbor;   // IE
}
	</style>
  </head>
  <body>
    <div id="container"></div>
    <div id="buttons">
      <input type="button" id="jump" value="Jump">
    </div>
    <script src="lib/kinetic-v4.6.0.min.js"></script>
    <script defer="defer">
      var keys = [];
      var bindings = [];
      bindings[87] = function(){
        skelaton.setAnimation('jump');

        skelaton.afterFrame(2, function() {
          skelaton.setAnimation('idle');
        });
      };
      bindings[68] = function(){
        skelaton.setAnimation('jump');
        if(skelaton.getScaleX() > 0){
          skelaton.setScaleX(-1);
          skelaton.setX(skelaton.getX()+skelaton.getWidth()/2);
        }
        skelaton.afterFrame(2, function() {
          skelaton.setAnimation('idle');
        });
      };
      bindings[65] = function(){
        skelaton.setAnimation('jump');
        if(skelaton.getScaleX() < 0){
          skelaton.setScaleX(1);
          skelaton.setX(skelaton.getX()-skelaton.getWidth()/2);
        }
        skelaton.afterFrame(2, function() {
          skelaton.setAnimation('idle');
        });
      };
      var skelaton;
      var stage = new Kinetic.Stage({
        container: 'container',
        width: 578,
        height: 200
      });
      var layer = new Kinetic.Layer();
      var animations = {
        idle: [{
          x: 96,
          y: 64,
          width: 32,
          height: 64
        }],
        jump: [{
          x: 0,
          y: 64,
          width: 32,
          height: 64
        }, {
          x: 32,
          y: 64,
          width: 32,
          height: 64
        }, {
          x: 64,
          y: 64,
          width: 32,
          height: 64
        }]
      };

      var imageObj = new Image();
      imageObj.onload = function() {
        skelaton = new Kinetic.Sprite({
          x: 250,
          y: 40,
          image: imageObj,
          animation: 'idle',
          animations: animations,
          frameRate: 7,
          index: 0,
          width: 64
        });
	
        // add the shape to the layer
        layer.add(skelaton);

        // add the layer to the stage
        stage.add(layer);

        // start sprite animation
        skelaton.start();

        // resume transition
        document.getElementById('jump').addEventListener('click', function() {
          skelaton.setAnimation('jump');

          skelaton.afterFrame(2, function() {
            skelaton.setAnimation('idle');
          });
        }, false);
      };
      document.onkeydown = function(evt){
        if(!keys[evt.keyCode] ){
          keys[evt.keyCode] = true;
          console.log(evt.keyCode);
          if(bindings[evt.keyCode])
            bindings[evt.keyCode]();
        }
      }
      document.onkeyup = function(evt){
        keys[evt.keyCode] = false;
      };
      imageObj.src = 'res/player.png';
    </script>
  </body>
</html>